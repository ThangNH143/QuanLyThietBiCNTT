<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <handlers>
            <!-- 
            HANDLER: Thêm iisnode handler.
            path="index.js" nghĩa là file chính để chạy Node.js là index.js
            -->
            <add name="iisnode" path="index.js" verb="*" modules="iisnode" />
        </handlers>

        <rewrite>
            <rules>
                <!-- 
                RULE 1: NGĂN CHẶN XỬ LÝ FILE TĨNH (RẤT QUAN TRỌNG)
                Nếu request là file tĩnh (CSS, JS, ảnh), bỏ qua Rule Rewrite để IIS tự phục vụ.
                Lưu ý: Không cần tiền tố đường dẫn ảo ở đây.
                -->
                <rule name="Prevent access to static assets" stopProcessing="true">
                    <match url="^(.+\.ico|.+css|.+js|.+jpe?g|.+png|.+gif|.+eot|.+svg|.+ttf|.+woff|.+woff2|.+json|.+svg)$" />
                    <action type="None" />
                </rule>

                <!-- 
                RULE 2: CHUYỂN HƯỚNG TẤT CẢ REQUEST CÒN LẠI VỀ CỔNG 3000
                (.*) bắt tất cả các đường dẫn con của Application này.
                {R:1} là phần đường dẫn sau /QuanLyThietBiCNTT/.
                -->
                <rule name="NodeJS Proxy All Requests" stopProcessing="true">
                    <match url="(.*)" />
                    <action type="Rewrite" url="http://localhost:3000/{R:1}" appendQueryString="true" />
                </rule>

                <!-- RULE 3 (TÙY CHỌN): Nếu dự án Node.js của bạn cần tiền tố đường dẫn ảo. -->
                <!-- Nếu không cần, bạn có thể bỏ qua Rule này. -->
                <!-- <rule name="NodeJS Proxy Base Path" stopProcessing="true">
                    <match url="^$" />
                    <action type="Rewrite" url="http://localhost:3000/QuanLyThietBiCNTT/" appendQueryString="true" />
                </rule> -->
            </rules>
        </rewrite>
        
        <!-- CẤU HÌNH iisnode -->
        <iisnode node_env="production" loggingEnabled="true" debuggingEnabled="false"
                 maxConcurrentRequests="1" /> 

    </system.webServer>
</configuration>